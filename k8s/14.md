# lab 14 

## kube prometheus stack 

Prometheus Operator: Simplifies the deployment of the Prometheus stack on a Kubernetes cluster, making the process more streamlined.

Prometheus: Gathers and stores metrics from applications, enabling monitoring and analysis of their performance.

Node-exporter: Collects hardware and operational metrics for Prometheus, providing insights into the underlying infrastructure.

Prometheus blackbox-exporter: Monitors endpoints and generates valuable information regarding availability and uptime.

Grafana: Facilitates the visualization of data through customizable dashboards, enhancing the understanding of monitoring metrics.

Alert manager: Manages alerts generated by Prometheus, forwarding them to designated channels like Telegram or email for timely notifications.

Prometheus Kubernetes API Adapter: Retrieves metrics from Kubernetes and exposes them to Prometheus, enabling Prometheus to access and monitor Kubernetes-specific information.

kube-state-metrics: Supplies Prometheus with metrics about the state of objects within the Kubernetes cluster, closely monitoring the Kubernetes API server.

## Outputs of the kubectl get po,sts,svc,pvc,cm

```bash 
NAME                                                            READY   STATUS    RESTARTS       AGE
pod/alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   2 (48s ago)    84m
pod/app-python-0                                                1/1     Running   5 (48s ago)    67m
pod/app-python-1                                                1/1     Running   5 (48s ago)    67m
pod/kube-prometheus-stack-grafana-8363c2784d-cs1xc              3/3     Running   4 (63s ago)    90m
pod/kube-prometheus-stack-kube-state-metrics-7e2553cds1-sh2z3   1/1     Running   3 (48s ago)    90m
pod/kube-prometheus-stack-operator-52cd23d78w-avs6w             1/1     Running   4 (48s ago)    90m
pod/kube-prometheus-stack-prometheus-node-exporter-ca2qd        1/1     Running   5 (63s ago)    90m
pod/prometheus-kube-prometheus-stack-prometheus-0               2/2     Running   3 (63s ago)    84m

NAME                                                               READY   AGE
statefulset.apps/alertmanager-kube-prometheus-stack-alertmanager   1/1     84m
statefulset.apps/app-python                                        2/2     67m
statefulset.apps/prometheus-kube-prometheus-stack-prometheus       1/1     84m

NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   35m
service/app-python                                LoadBalancer   10.104.127.151   <none>        8000/TCP                     15d
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      15d
service/kube-prometheus-stack-grafana             ClusterIP      10.97.133.125    <none>        80/TCP                       90m
service/kube-prometheus-stack-alertmanager        ClusterIP      10.109.52.18     <none>        9093/TCP                     90m
service/kube-prometheus-stack-operator            ClusterIP      10.111.29.248    <none>        443/TCP                      90m
service/kube-prometheus-stack-prometheus          ClusterIP      10.106.182.23    <none>        9090/TCP                     90m
service/kube-state-metrics                        ClusterIP      10.97.250.33     <none>        8080/TCP                     90m
service/prometheus-node-exporter                  ClusterIP      10.108.177.186   <none>        9100/TCP                     90m
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     35m


NAME                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/data-app-python-0   Bound    pvc-a4f1263e-1f76-2b47-d83a-6865c52cb3d4   1Gi        RWO            standard       15d
persistentvolumeclaim/data-app-python-1   Bound    pvc-74da8342-93dc-4959-b673-a2b5a342da23   1Gi        RWO            standard       15d

NAME                                                                DATA   AGE
configmap/kube-prometheus-stack-alertmanager-overview               1      90m
configmap/kube-prometheus-stack-apiserver                           1      90m
configmap/kube-prometheus-stack-cluster-total                       1      90m
configmap/kube-prometheus-stack-controller-manager                  1      90m
configmap/kube-prometheus-stack-etcd                                1      90m
configmap/kube-prometheus-stack-grafana                             1      90m
configmap/kube-prometheus-stack-grafana-config-dashboards           1      90m
configmap/kube-prometheus-stack-grafana-datasource                  1      90m
configmap/kube-prometheus-stack-grafana-overview                    1      90m
configmap/kube-prometheus-stack-k8s-coredns                         1      90m
configmap/kube-prometheus-stack-k8s-resources-cluster               1      90m
configmap/kube-prometheus-stack-k8s-resources-multicluster          1      90m
configmap/kube-prometheus-stack-k8s-resources-namespace             1      90m
configmap/kube-prometheus-stack-k8s-resources-node                  1      90m
configmap/kube-prometheus-stack-k8s-resources-pod                   1      90m
configmap/kube-prometheus-stack-k8s-resources-workload              1      90m
configmap/kube-prometheus-stack-k8s-resources-workloads-namespace   1      90m
configmap/kube-prometheus-stack-kubelet                             1      90m
configmap/kube-prometheus-stack-namespace-by-pod                    1      90m
configmap/kube-prometheus-stack-namespace-by-workload               1      90m
configmap/kube-prometheus-stack-node-cluster-rsrc-use               1      90m
configmap/kube-prometheus-stack-node-rsrc-use                       1      90m
configmap/kube-prometheus-stack-nodes                               1      90m
configmap/kube-prometheus-stack-nodes-darwin                        1      90m
configmap/kube-prometheus-stack-persistentvolumesusage              1      90m
configmap/kube-prometheus-stack-pod-total                           1      90m
configmap/kube-prometheus-stack-prometheus                          1      90m
configmap/kube-prometheus-stack-proxy                               1      90m
configmap/kube-prometheus-stack-scheduler                           1      90m
configmap/kube-prometheus-stack-workload-total                      1      90m
configmap/prometheus-kube-prometheus-stack-prometheus-rulefiles-0   35     84m
```

## brief explanation of the outputs:

1. kubectl get po:
- Lists the pods running in the cluster (first handles the alerts, second from previous lab, others monitor the kube prometheus stack components)
- Provides information about each pod's name, readiness, status, restarts, and age.
2. kubectl get sts:
- Displays the stateful sets in the cluster (managing the correspongind components of KPS)
- Shows the readiness and age of each stateful set.
3. kubectl get svc:
- Shows the services in the cluster.
- Provides details such as service name, type, cluster IP, external IP, and associated ports.
4. kubectl get pvc:
- Lists the persistent volume claims in the cluster.
- Displays information about each claim's name, status, associated volume, capacity, and access modes.
5. kubectl get cm:
- Retrieves the config maps in the cluster.
- Shows the name and data available in each config map.

## answers to the questions: 

1. Check CPU and Memory consumption of your StatefulSet.
- CPU: 0,0018%
- Memory: 38MiB
2. Identify Pods with higher and lower CPU usage in the default namespace.
- higher usage: prometheus
- lower usage: alertmanager 
3. Monitor node memory usage in percentage and megabytes.
- memory usage: 40.7% (4.32 GiB)
4. Count the number of pods and containers managed by the Kubelet service.
- pods: 17
- containers: 26
5. Evaluate network usage of Pods in the default namespace.
- network usage: 35 kB/s (download), 117 kB/s (upload)
6. Determine the number of active alerts
- active alerts: 10

## init container (kubectl exec pod/app-python-0 -- cat /work-dir/test.html)

```bash
Defaulted container "app-python" out of: app-python, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>
<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```